#CPE WILDFLY CONFIGURATION
#Pebake steps
#create users and groups
/usr/sbin/groupadd -g 713 mdware;
/usr/sbin/useradd -g mdware jboss;
yum -y install sendmail;
yum -y install sharutils;
yum -y install sendmail-cf;
#Create Directories
mkdir -p /apps/opt/incoming ; chmod 755 /apps/opt/incoming;
#Download Packages
curl -u SVC-CMB-INFRA-DEPLOY:dI16mC16rdI16mC16rdI16mC16rdI -o /apps/opt/incoming/VZjdk-1.8.0_172_b31_64bit-Linux.rpm https://oneartifactory.verizon.com/artifactory/VVOV_SSP/WILDFLY_PACKAGES/VZjdk-1.8.0_172_b31_64bit-Linux.rpm
curl -u SVC-CMB-INFRA-DEPLOY:dI16mC16rdI16mC16rdI16mC16rdI -o /apps/opt/incoming/VZwldfly-17.0.0.Final-Linux.rpm https://oneartifactory.verizon.com/artifactory/VVOV_SSP/WILDFLY_PACKAGES/VZwldfly-17.0.0.Final-Linux.rpm
curl -u SVC-CMB-INFRA-DEPLOY:dI16mC16rdI16mC16rdI16mC16rdI -o /apps/opt/incoming/VZwfscr-1.8-Linux.rpm https://oneartifactory.verizon.com/artifactory/VVOV_SSP/WILDFLY_PACKAGES/VZwfscr-1.8-Linux.rpm
#List Packages - rpm -qi {VZjdk,VZwldfly,VZwfscr}
#Remove packages - rpm -ev {VZwfscr-,VZwldfly-,VZjdk-}
#Install Packages
yum install java
rpm -ihv --ignorearch --ignoreos --nodeps --force /apps/opt/incoming/VZwldfly-17.0.0.Final-Linux.rpm
rpm -ihv --ignorearch --ignoreos --nodeps --force /apps/opt/incoming/VZwfscr-1.8-Linux.rpm
#Server Configuration
#egrep "jboss.bind.address|jboss.http.port" /apps/opt/cpe/config/cpe-srv01/configuration/standalone.xml
perl -pi -e 's/127.0.0.1/10.118.3.136/g' /apps/opt/cpe/config/cpe-srv01/configuration/standalone.xml

egrep "jboss.bind.address|jboss.http.port" /apps/opt/wildfly/wildfly-17.0.0.Final/standalone/configuration/standalone.xml
#perl -pi -e 's/127.0.0.1/10.118.3.136/g' /apps/opt/wildfly/wildfly-17.0.0.Final/standalone/configuration/standalone.xml
#perl -pi -e 's/127.0.0.1/10.118.3.136/g' /apps/opt/wildfly/wildfly-17.0.0.Final/domain/configuration/domain.xml
mkdir -p /apps/opt/cpe/config ; chown -R jboss:mdware /apps/opt/cpe/config
su - jboss
cp -r /apps/opt/wildfly/wildfly-17.0.0.Final/standalone /apps/opt/cpe/config/cpe-srv01
mkdir -p /apps/opt/cpe/config/cpe-srv01/{modules,logs,data}
#chgrp -R mdware /apps/opt/cpe/config/cpe-srv01 ; chmod -R 775 /apps/opt/cpe/config/cpe-srv01

#Add path as environment variable
echo -e "export JAVA_HOME=/apps/opt/jdk/jdk180_172_64\nexport PATH=\$JAVA_HOME/bin:\$PATH" >> ~/.bash_profile
echo -e "export WILDFLY_HOME=/apps/opt/wildfly/wildfly-17.0.0.Final" >> ~/.bash_profile

#######################################################

root@10-118-3-136:/apps/opt/cpe-srv01 # /apps/opt/wildfly/scripts/AdminWrapper -a DISABLESERVER -s cpe-srv01
INFO:  Starting AdminWrapper with action DISABLESERVER for server cpe-srv01 : Wed Sep 18 08:20:59 EDT 2019
INFO:  Disabled start/stop/monitoring/logfile-mgmt for the cpe-srv01 server
INFO:  Finished AdminWrapper for cpe-srv01 : Wed Sep 18 08:20:59 EDT 2019
root@10-118-3-136:/apps/opt/cpe-srv01 # /apps/opt/wildfly/scripts/AdminWrapper -a ENABLESERVER -s cpe-srv01
INFO:  Starting AdminWrapper with action ENABLESERVER for server cpe-srv01 : Wed Sep 18 08:21:09 EDT 2019
INFO:  Enabled start/stop/monitoring/logfile-mgmt for the cpe-srv01 server
INFO:  Finished AdminWrapper for cpe-srv01 : Wed Sep 18 08:21:09 EDT 2019

#######################################################
root@10-118-3-136:/apps/opt/cpe-srv01 # /apps/opt/wildfly/scripts/AdminWrapper -a START -s cpe-srv01
INFO:  Starting AdminWrapper with action START for server cpe-srv01 : Wed Sep 18 08:23:45 EDT 2019
WARNING:  Unable to identify PID for cpe-srv01 server
tee: /apps/opt/cpe-srv01/standalone/logs/jBossAdmin.log: No such file or directory
INFO:  Starting jBossAdmin with action START for cpe-srv01 : Wed Sep 18 08:23:45 EDT 2019
tee: /apps/opt/cpe-srv01/standalone/logs/jBossAdmin.log: No such file or directory
INFO:  Server Process PID file for cpe-srv01 is empty/missing ...
tee: /apps/opt/cpe-srv01/standalone/logs/jBossAdmin.log: No such file or directory
INFO:  Server Process for cpe-srv01 not running ... Starting server
INFO:  Started jBoss server cpe-srv01 Successfully. PID 18780
INFO:  Started jBoss server cpe-srv01 Successfully.
INFO:  Finished jBossAdmin for cpe-srv01 with status 0 : Wed Sep 18 08:24:00 EDT 2019
INFO:  Command Executed for cpe-srv01 ...
INFO:  Finished AdminWrapper for cpe-srv01 : Wed Sep 18 08:24:00 EDT 2019
root@10-118-3-136:/apps/opt/cpe-srv01 #
#######################################################
#Add Users
/apps/opt/wildfly/scripts/AdminWrapper -a STOP -s cpe-srv01
/apps/opt/wildfly/scripts/AdminWrapper -a START -s cpe-srv01
#Console Url :   http://10.118.3.136:9991/console/index.html
http://10-118-3-136.ebiz.verizon.com:9991/console/index.html

#######################################################

[jboss@10-118-3-136 ~]$ /apps/opt/wildfly/scripts/AuthAdmin -s cpe-srv01

What type of user do you wish to add?
 a) Management User (mgmt-users.properties)
 b) Application User (application-users.properties)
(a): a

Enter the details of the new user to add.
Using realm 'ManagementRealm' as discovered from the existing property files.
Username : wfappadmin
Password recommendations are listed below. To modify these restrictions edit the add-user.properties configuration file.
 - The password should be different from the username
 - The password should not be one of the following restricted values {root, admin, administrator}
 - The password should contain at least 8 characters, 1 alphabetic character(s), 1 digit(s), 1 non-alphanumeric symbol(s)
Password :
Re-enter Password :
What groups do you want this user to belong to? (Please enter a comma separated list, or leave blank for none)[  ]:
About to add user 'wfappadmin' for realm 'ManagementRealm'
Is this correct yes/no? yes
Added user 'wfappadmin' to file '/apps/opt/cpe/config/cpe-srv01/configuration/mgmt-users.properties'
Added user 'wfappadmin' to file '/apps/opt/wildfly/wildfly-17.0.0.Final/domain/configuration/mgmt-users.properties'
Added user 'wfappadmin' with groups  to file '/apps/opt/cpe/config/cpe-srv01/configuration/mgmt-groups.properties'
Added user 'wfappadmin' with groups  to file '/apps/opt/wildfly/wildfly-17.0.0.Final/domain/configuration/mgmt-groups.properties'
Is this new user going to be used for one AS process to connect to another AS process?
e.g. for a slave host controller connecting to the master or for a Remoting connection for server to server EJB calls.
yes/no? no
[jboss@10-118-3-136 ~]$
